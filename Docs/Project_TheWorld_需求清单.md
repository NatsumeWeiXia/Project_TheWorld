## Project_TheWorld功能需求清单

整体参考Palantir Foundry和 AIP的思想，构建一套基于本体的AI操作系统。

### 1. 本体管理

#### 1.1 本体管理

**需求描述：**

* 能够进行本体的管理，包括增删改查。
* 本体包含数据属性（即本体class所包含的字段信息）、对象属性（即一些本体和另一些本体的关联、转换关系，多对多）、能力（即本体上可执行的动作Action）、可以进行物理表映射或接口绑定用以取数。
* 本体有继成关系，子本体继成父本体的全部属性和关系以及能力。

**验收条件：**

#### 1.2 本体能力【高】

**需求描述：**

* **本体的关联关系定义为：**从一些本体到另一些本体的转换、查询能力。多对多，依托于Skill，可额外添加MCP。该Skill/MCP的输入为起点本体，输出为终点本体。
* **本体的能力定义为：**一个本体本身可执行的能力，无指向本体，输出结果直接返回。依托于Skill，可额外添加MCP。该Skill/MCP的输入为该本体。
* 对于输入和输出非标准本体格式的Skill、MCP，需提供大模型辅助的参数提取、映射能力，将其转换为对应本体。【中】

**验收条件：**

#### 1.3 知识框架【高】

**需求描述：**

知识录入应遵循“意图描述”+“少样本示例”，减少大段的固定描述，降低prompt总长度，同时应在必要的地方直接提供JSON Schema描述。工具系统应就这些原则提供引导和建议。

* **本体Class知识：**提供本体Class知识的录入、管理框架。本体Class知识至少包含四个部分：
  * 本体概述：简明扼要的对本体本身进行描述，其含义、业务等信息，使对该本体获得精准的理解。
  * 本体约束：简明扼要的对该本体下的约束进行定义，如：如果手机号和身份证号均为空，则数据无效，等。
  * 本体对象属性：该本体下所有关联关系的描述部分。描述需明确、准确避免和其他描述产生歧义（补充说明：skill 描述部分）。
  * 本体能力：该本体下所有能力的描述部分。描述需明确、准确避免和其他描述产生歧义（补充说明：skill 描述部分）。
* **数据属性知识：**提供数据属性知识的录入、管理框架。数据属性知识至少包含两个部分：
  * 属性说明：对该数据属性进行必要的名词解释，对其在该领域下存在的额外含义进行说明，对其同义、类似的名词进行说明。
  * 属性约束：简明扼要的对该属性的约束进行定义，如：身份证号位数、母亲必须是女性，等。
* **对象属性知识：**提供关联关系知识的录入、管理框架（补充说明：skill.md 部分）。关联关系的知识至少包含两个部分：
  * 提示词模板：对应本体class知识中本体关系下该关联关系的描述部分的提示词模板，模板需详细、准确、经过了调试验证，作为模板需具有动态传参拼接最终提示词的能力。
  * 关联的MCP：如果该关联关系需要MCP进行辅助，则可配置MCP，MCP可配置多个。需在提示词模板中，明确定义MCP调用的入口和结果返回拼接的位置。同时需要将MCP返回的本体存入全局本体实例上下文管理中。
* **本体能力知识：**提供本体能力的知识的录入、管理框架（补充说明：skill.md 部分）。能力的知识至少包含两个部分：
  * 提示词模板：对应本体class知识中本体能力下该能力的描述部分的提示词模板，模板需详细、准确、经过了调试验证，作为模板需具有动态传参拼接最终提示词的能力。
  * 关联的MCP：如果该能力需要MCP进行辅助，则可配置MCP，MCP可配置多个。需在提示词模板中，明确定义MCP调用的入口和结果返回拼接的位置。

**验收条件：**

#### 1.4 本体图【中】

**需求描述：**

* 全局的本体关系图，可以展示本体、数据属性、对象属性、来源表、能力等信息。以本体为最基本的点、对象属性为线，本体下可展开其包含的数据属性、能力等。可进一步展开其来源表、接口及相关处理逻辑、画布。
* 本体图上提供各种滤镜，包括：权限滤镜、任务健康度滤镜、使用频次滤镜、数据量滤镜等。【低】

**验收条件：**

#### 1.5 本体权限管理【低】

**需求描述：**

**验收条件：**

#### 1.6 补充说明【新增】

**需求描述：**

* 所有本体、数据属性、对象属性需符合OWL标准规范，可以通过rdf4j或其他工具输出标准的OWL文件。
* 本体：对应OWL中的class，可以在其说明中填写“本体Class知识”。本体间有父子关系，在管理页面中应以树状图的形式进行管理（增删改查）。
* 数据属性：对应OWL中的数据属性，数据属性全局声明，在本体中对其进行引用，可在其说明中填写“数据属性知识”。数据属性应有自己的独立的全量数据属性管理页（增删改查），每个本体中应该有该本体引用哪些数据属性的配置能力。
* 对象属性：对应OWL中的对象属性，对象属性domain和range均为本体，均可以有多个本体，可在其说明中填写“对象属性知识”。对象属性应有自己的独立全量对象属性管理页（增删改查），每个本体中应该有该本体关联了哪些对象属性的查看能力。
* 本体能力：对应Palantir中Action概念，能力可以挂载在某个本体上，也可以独立存在，可在其说明中填写“本体能力知识”，在OWL中扩展自定义标签来存储该部分。本体能力应有自己的独立的全量本体能力管理页（增删改查），每个本体中应该有该本体关联了哪些本体能力的查看能力。
* 本体关联表：在OWL中扩展自定义标签来存储该部分，该部分定义该本体和数据库中某个具体的表的对应关系以及该本体引用的数据属性和表中字段的对应关系，用以实现本体概念和实际数据的绑定。每个本体中应该有该本体的关联表的配置能力以及数据属性和表字段映射的配置能力，每个本体只可配置一张关联表。

**验收条件：**

### 2. 推理框架

#### 2.1 系统MCP【高】

**需求描述：**

* 完成多个系统级元数据获取能力，筛选接口作用范围为当前环境中启用的领域：

  * **数据属性匹配查询接口：**能够根据条件返回相关的数据属性，查询接口应结合关键词、向量等技术，尽可能精确返回与输入关键词含义相近的数据属性。返回的数据属性包括数据属性的名称、ID、及其上挂载的知识，以方便大模型基于返回结果进行二次筛选。
  * **数据属性查询本体接口：**能够根据输入的多个数据属性，返回包含这些数据属性的本体，返回的本体中应标明其包含的入参数据属性情况，关联的性越强的排在前面。返回的本体情况包括：本体名称、ID、及其上挂载的知识，以方便大模型基于返回的结果进行二次筛选。
  * **本体详情查询接口：**能够根据输入本体ID，返回本体的详情。本体详情包括本体本身的信息（名称、ID、其上挂载的知识），还包括本体下的属性以及属性挂载的知识。
  * **关联关系、能力详情查询接口：**大模型通过本体描述中的关系和能力，分析后再具体通过本接口拉取某个关系、能力的具体执行逻辑。

* 完成多个系统级数据获取能力：

  * **条件查询接口：**可以灵活根据本体中生效的任意数据属性的组合，查询出符合该条件的结果，查询需支持查询有结果表本体、无结果表本体、绑定接口的本体等不同的物理存储类型的本体。
  
  * **分组分析接口：**可以灵活根据本体中生效的任意数据属性的组合，对该本体下的数据进行分组分析，分组分析需支持有结果表本体、无结果表本体、绑定的接口具有该能力的本体等不同的物理存储类型的本体。
  
* 所有本体需支持分页获取数据，并引导大模型进行递进式数据获取，先返回关系最大的，以控制上下文窗口中加载的数据量。

**验收条件：**

#### 2.2 推理引导框架【高】

**需求描述：**

* 具备引导大模型主动读取本体的能力，引导大模型基于本体提供的能力完成工作。**在无相关能力匹配的情况下，主动抛出无匹配技能给用户，在识别到多个类似能力时，主动询问用户采用哪一个。**具体为以下几个方面：
  * **工作对象为用户输入时：**当工作对象为用户输入时，大模型应使用自身能力，理解用户意图，识别提取其中的关键业务概念。主动生成入参并使用 “数据属性匹配查询接口” 获取相关数据属性，并根据返回的数据属性确定用户输入的内容包含了哪些数据属性。
  * **工作对象为用户输入+挑选好的数据属性时：**当工作对象为用户输入和挑选好的数据属性时，大模型应生成入参并使用 “数据属性查询本体接口” 获取和数据属性相关的本体，并根据返回的本体确定用户输入的内容和哪些本体相关。
  * **工作对象为用户输入+挑选好的本体时：**当工作对象为用户输入和挑选好的本体时，大模型应生成入参并使用 ”本体详情查询接口“ 获取本体的具体描述，根据描述，确定该本体是否有符合用户意图的能力，将符合用户意图的能力加入待执行列表。
  * **工作对象为用户输入+待执行列表时：** 根据待执行列表，获取其中的待执行任务，并判断任务是否可以并行，对于可以并行的任务，主动拉起其他会话进行执行，在其他会话异步执行完后，结果汇总至主回话（异步线程）。
  * **工作对象为用户输入+一个具体的任务时：** 根据任务中的具体工作步骤（来源于前序选定的本体能力上挂载的知识），规划该任务的实际执行，在必要的时候调用数据获取能力。对于任务中嵌套了其他任务的，可以根据指引，搜寻本体知识获取到对应的任务的详细内容，重复本步骤。最终实现任务的递归执行和结果逐层返回。
  * **工作对象为用户输入+任务执行结果时：** 如果执行结果仍是本体，则重复 ”工作对象为用户输入+挑选好的本体时“ 步骤，直到无和用户意图相关任务需要加入待执行列表。

**验收条件：**

#### 2.3 能力动态加载【中】

**需求描述：**

* 动态管理传递给大模型的工具列表，除系统级MCP全程加载外，根据当前会话涉及的本体，动态将本体能力加载至工具列表。

**验收条件：**

#### 2.4 会话管理【中】

**需求描述：**

* 用户和系统的一次会话包含多次系统和大模型的会话，系统需基于稳定优秀的开源框架提供以下能力：
  * **主会话能力：**主会话为用户会话的入口和最终的出口，类比为系统的主线程，负责最初的意图识别、分析规划、在必要时拉起其他会话、接收其他会话结果并综合给出最终结果。
  * **子会话能力：**主会话在判断任务可以并行时或需要递归时，主动拉起的会话，子会话接收主会话给出的任务要求并进行执行，执行结果返回主会话。子会话可在必要时再拉起子会话。
  * **多会话管理能力：**能够管理不同会话间的隶属关系，并在子会话完成后完成递归、嵌套的闭环。
  * **会话内错误处理能力：**当会话内调用MCP报错时，能够将错误回送给大模型，由大模型进行入参调整或基于错误继续等行为。

**验收条件：**

#### 2.5 上下文管理【中】

**需求描述：**

* 用户和系统的一次会话会产生很多上下文，上下文包括本体、实例、分析结果等内容，系统需基于稳定优秀的开源框架提供以下能力：
  * **上下文存储：** 推理过程中获取的本体元数据、实例、及用户输入和模型输出（暂不包含Thinking过程），存储在各个会话的上下文存储中。
  * **上下文隔离与共享：**当多个会话间存在依赖、递归时，子会话可以读取其父会话的上下文。父会话不需要汇总其子会话的上下文。
  * **上下文的传递：**当子会话结束时，根据任务指引，将必要的本体、实例、分析结果传递给父会话，添加至父会话上下文。
  * **记忆压缩**：可以根据策略，在子会话回传或者单会话多轮后，自动触发总结，形成结构化记忆信息。如：将前序加载的Tools取消，将加载的本体能力详情Prompt去除，仅保留本体下的索引描述等。

**验收条件：**

#### 2.6 推理链路追踪【高】

**需求描述：**

* 系统需具有推理链路追踪能力，可以记录并展示大模型的推理过程、MCP调用过程、会话的生命周期过程、上下文的内容及变更过程并进行展示，具体如下：
  * **推理日志：**对每一次用户会话，应有推理日志详细记录每次和大模型通信的会话信息、输入信息、输出信息。
  * **MCP调用日志**：对每一次MCP调用，应用调用日志详细记录MCP的调用时间、入参、出参等信息。
  * **链路展示：**应具有推理路径图，展示大模型的思考过程，包括其获取的上下文内容（数据属性、本体、关系、能力等），执行链及每一步的输入输出情况等。

**验收条件：**
